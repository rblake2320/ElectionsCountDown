CRITICAL ISSUES - Real Fix Strategy:

  1. Missing State Data Issue:

  -- Tell the AI:
  "First, check which states actually have elections:
  SELECT state, COUNT(*) as election_count
  FROM elections
  GROUP BY state
  ORDER BY state;

  -- You probably only have 10-15 states. You need all 50 + territories."

  2. Fix Election Type Filtering:

  // The error is likely because:
  - 'type' column might have NULL values
  - Filtering logic expects specific values but gets undefined
  - Frontend sends 'all' but backend doesn't handle it

  // Fix:
  "Debug the election type filter by:
  1. Check what values exist: SELECT DISTINCT type FROM elections;
  2. Update filter logic to handle 'all' option
  3. Ensure no NULL values in type column"

  3. Fix Party Filtering:

  // Party data is probably in candidates table, not elections
  // The filter is looking in wrong table

  "Fix party filtering:
  1. JOIN elections with candidates table
  2. Filter by candidate.party not election.party
  3. Handle elections with no candidates"

  4. Comprehensive Test That Actually Works:

  // Create real-world-test.js

  async function testRealUserFlow() {
    console.log("Testing ACTUAL user experience...\n");

    // Test 1: Can user see elections in EVERY state?
    const states = ['AL','AK','AZ','AR','CA','CO','CT','DE','FL','GA',
                    'HI','ID','IL','IN','IA','KS','KY','LA','ME','MD',
                    'MA','MI','MN','MS','MO','MT','NE','NV','NH','NJ',
                    'NM','NY','NC','ND','OH','OK','OR','PA','RI','SC',
                    'SD','TN','TX','UT','VT','VA','WA','WV','WI','WY'];

    for (const state of states) {
      const res = await fetch(`/api/elections?state=${state}`);
      const data = await res.json();
      if (!data.elections || data.elections.length === 0) {
        console.log(`❌ NO ELECTIONS FOR ${state}`);
      }
    }

    // Test 2: All filter combinations
    const types = ['all', 'primary', 'general', 'special'];
    const levels = ['all', 'federal', 'state', 'local'];
    const parties = ['all', 'Democratic', 'Republican', 'Independent'];

    for (const type of types) {
      const res = await fetch(`/api/elections?type=${type}`);
      if (!res.ok) console.log(`❌ Type filter '${type}' BROKEN`);
    }

    for (const party of parties) {
      const res = await fetch(`/api/elections?party=${party}`);
      if (!res.ok) console.log(`❌ Party filter '${party}' BROKEN`);
    }

    // Test 3: Click every UI element
    console.log("\nTest clicking every filter in UI");
  }

  5. Data Population Fix:

  -- Tell the AI:
  "Use the Perplexity AI search to find ALL elections for missing states:

  1. Search: 'All elections in [STATE] from June 2025 to November 2026'
  2. Add primary dates for each state
  3. Add ALL House races (435 districts)
  4. Add ALL Senate races (33 in 2026)
  5. Add gubernatorial races for all 36 states

  The current 170 elections should be at least 1,000+ when complete."

  6. Fix Filter Logic:

  // In the API route handler:
  if (filters.type && filters.type !== 'all') {
    query.where('type', filters.type);
  }

  if (filters.party && filters.party !== 'all') {
    // JOIN with candidates table
    query.join('candidates', 'elections.id', 'candidates.election_id')
         .where('candidates.party', filters.party);
  }

  if (filters.state && filters.state !== 'all') {
    query.where('state', filters.state);
  }

  Tell the AI:
  "STOP declaring things 'production ready'. Instead:
  1. First run: SELECT state, COUNT(*) FROM elections GROUP BY state
  2. Load elections for ALL missing states using AI search
  3. Fix the filter logic to handle 'all' option properly
  4. Test EVERY filter combination manually
  5. Only after ALL states work and ALL filters work, then test other features"

  The platform is NOT ready until:
  - All 50 states + territories have elections
  - Every filter works without errors
  - The UI doesn't break when clicking options